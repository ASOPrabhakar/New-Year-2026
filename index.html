<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy New Year 2026</title>

<style>
*{box-sizing:border-box}
body{
 margin:0;height:100vh;overflow:hidden;
 font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI','Segoe UI Emoji','Apple Color Emoji','Noto Color Emoji',sans-serif;
 background:radial-gradient(circle at top,#0b1d3a 0%,#020824 60%,#000 100%);
}

/* ===== SIZE CONTROLS ===== */
.size-controls{
 position:fixed;top:14px;right:14px;
 z-index:20000;display:flex;gap:8px;
 opacity:0;pointer-events:none;transition:.3s;
}
.size-controls.show{opacity:1;pointer-events:auto}
.size-controls button{
 width:34px;height:34px;border:none;border-radius:50%;
 font-size:18px;font-weight:900;
 background:#ffffffcc;cursor:pointer;
 box-shadow:0 3px 10px rgba(0,0,0,.4);
}

/* ===== STARS ===== */
.stars{position:fixed;inset:0;z-index:0;pointer-events:none}
.stars::before,.stars::after{
 content:"";position:absolute;inset:0;
 background-image:
  radial-gradient(1px 1px at 10% 20%, #fff, transparent),
  radial-gradient(1px 1px at 30% 80%, #fff, transparent),
  radial-gradient(1.5px 1.5px at 50% 40%, #fff, transparent),
  radial-gradient(1px 1px at 70% 30%, #fff, transparent),
  radial-gradient(1.5px 1.5px at 90% 70%, #fff, transparent);
 background-size:300px 300px;opacity:.8
}
.stars::after{background-size:600px 600px;opacity:.5}

canvas{position:fixed;inset:0;z-index:15;pointer-events:none}

/* ===== COVER ===== */
.cover{
 position:fixed;inset:0;z-index:99999;
 background:radial-gradient(circle at top,#ffb347,#ff6a00 40%,#c31432);
 display:flex;align-items:center;justify-content:center;
 cursor:pointer;transition:opacity 2s ease,filter 2s ease;
}
.cover.hide{opacity:0;filter:blur(25px);pointer-events:none}
.tap{
 z-index:100000;color:#fff;font-size:32px;font-weight:900;
 padding:22px 38px;border-radius:18px;
 animation:pulse 1.6s infinite;
 user-select:none;
}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

/* ===== POPUP ===== */
.popup{
 position:fixed;top:44%;left:50%;
 transform:translate(-50%,-50%) scale(.5);
 width:380px;padding:36px;text-align:center;
 opacity:0;z-index:30;
 transition:transform 1.6s cubic-bezier(.15,.9,.15,1),opacity 1.6s ease;
}
.popup.show{opacity:1;transform:translate(-50%,-50%) scale(1)}

/* ===== FIX OVERLAP + EDIT ===== */
.popup h2,
.poetry,
.footer{
 font-family: system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI','Segoe UI Emoji','Apple Color Emoji','Noto Color Emoji',sans-serif;
 position:relative;
 pointer-events:auto;
 user-select:text;
}

/* IMPORTANT FIX */
.popup h2{
 max-width:100%;
 line-height:1.3;
 word-break:break-word;
}

/* ===== COLORFUL TEXT ===== */
.popup h2{
 font-size:28px;margin-bottom:14px;
 background:linear-gradient(90deg,#ff0080,#ff8c00,#ffd700,#00ffcc,#00bfff);
 background-size:300% 300%;
 animation:rainbow 6s ease infinite;
 -webkit-background-clip:text;
 -webkit-text-fill-color:transparent;
}
.poetry{
 font-weight:800; /* BOLD middle text */
 font-size:20px;line-height:1.8;
 background:linear-gradient(180deg,#ffffff,#ffecd2,#fcb69f,#ffe259,#ffa751);
 background-size:200% 200%;
 animation:softGlow 5s ease-in-out infinite;
 -webkit-background-clip:text;
 -webkit-text-fill-color:transparent;
}
.footer{
 margin-top:18px;font-size:19px;font-weight:800;
 background:linear-gradient(90deg,#00f2ff,#7cffcb,#ffd86b,#ff9a9e);
 background-size:300% 300%;
 animation:rainbow 6s ease infinite;
 -webkit-background-clip:text;
 -webkit-text-fill-color:transparent;
}

@keyframes rainbow{
 0%{background-position:0% 50%}
 50%{background-position:100% 50%}
 100%{background-position:0% 50%}
}
@keyframes softGlow{
 0%{background-position:50% 0%}
 50%{background-position:50% 100%}
 100%{background-position:50% 0%}
}

/* ===== CONTROLS ===== */
.controls{
 position:fixed;bottom:18px;left:50%;
 transform:translateX(-50%);
 display:flex;gap:10px;z-index:40;
}
.controls button{
 padding:12px 22px;border:none;border-radius:22px;
 font-weight:800;cursor:pointer;
 opacity:.45;transition:.25s;
}
.controls button.active{
 opacity:1;
 transform:scale(1.05);
 box-shadow:0 6px 18px rgba(0,0,0,.45);
}
.edit{background:#7cffcb}
.set{background:#00e0ff}
.share{background:#ff9f00}

/* ===== SET POPUP ===== */
.set-popup{
 position:fixed;top:50%;left:50%;
 transform:translate(-50%,-50%) scale(.7);
 background:#00e0ff;
 color:#000;
 padding:18px 28px;
 border-radius:18px;
 font-weight:900;
 z-index:50000;
 opacity:0;
 transition:.4s;
}
.set-popup.show{
 opacity:1;
 transform:translate(-50%,-50%) scale(1);
}
</style>
</head>

<body>
<div class="stars"></div>
<canvas id="fx"></canvas>

<div class="size-controls" id="sizeControls">
 <button onclick="resizeText(-1)">A−</button>
 <button onclick="resizeText(1)">A+</button>
</div>

<div class="cover" id="cover">
 <div class="tap" id="tapBtn">जल्दी से टैप करें</div>
</div>

<div class="popup" id="popup">
 <h2 id="t1" contenteditable="false">नववर्ष की हार्दिक शुभकामनाएँ</h2>
 <div id="t2" class="poetry" contenteditable="false">
  सूरज की तरह चमके आपकी किस्मत,<br>
  चाँद की तरह खिलते रहें आप,<br>
  नए साल में हर ग़म रहे आपसे कोसों दूर,<br>
  सफलता की ऊँचाइयों को छूते रहें आप।
 </div>
 <div id="t3" class="footer" contenteditable="false">
  नववर्ष 2026 की हार्दिक शुभकामनाएँ
 </div>
</div>

<div class="controls">
 <button class="edit" id="editBtn">EDIT</button>
 <button class="set" id="setBtn">SET</button>
 <button class="share" id="shareBtn">SHARE</button>
</div>

<div class="set-popup" id="setPopup">✅ Set ho gaya!</div>

<script>
/* ===== OPEN ===== */
const cover=document.getElementById('cover');
const tapBtn=document.getElementById('tapBtn');
const popup=document.getElementById('popup');
const sizeControls=document.getElementById('sizeControls');
let opened=false;

function openCard(){
 if(opened) return;
 opened=true;
 cover.classList.add('hide');
 sizeControls.classList.add('show');
 setTimeout(()=>{popup.classList.add('show'); speakText();},700);
 startFireworks();
}
tapBtn.onclick=openCard;
cover.onclick=openCard;
tapBtn.addEventListener('touchstart',openCard,{passive:true});
cover.addEventListener('touchstart',openCard,{passive:true});

/* ===== BUTTON STATE ===== */
const editBtn=document.getElementById('editBtn');
const setBtn=document.getElementById('setBtn');
const shareBtn=document.getElementById('shareBtn');
const allBtns=[editBtn,setBtn,shareBtn];
function activate(btn){
 allBtns.forEach(b=>b.classList.remove('active'));
 btn.classList.add('active');
}

/* ===== EDIT / SET / SHARE ===== */
editBtn.onclick=()=>{
 activate(editBtn);
 t1.contentEditable='true';
 t2.contentEditable='true';
 t3.contentEditable='true';
};

setBtn.onclick=()=>{
 activate(setBtn);
 t1.contentEditable='false';
 t2.contentEditable='false';
 t3.contentEditable='false';
 localStorage.setItem('ny2026',JSON.stringify({
  a:t1.innerHTML,b:t2.innerHTML,c:t3.innerHTML
 }));
 showSetPopup();
 speakText();        // SPEAK AGAIN AFTER SET
};

shareBtn.onclick=()=>{
 activate(shareBtn);
 shareLink();
};

/* ===== SET POPUP ===== */
const setPopup=document.getElementById('setPopup');
function showSetPopup(){
 setPopup.classList.add('show');
 setTimeout(()=>setPopup.classList.remove('show'),1500);
}

/* ===== LOAD SAVED ===== */
const saved=localStorage.getItem('ny2026');
if(saved){
 const d=JSON.parse(saved);
 t1.innerHTML=d.a;t2.innerHTML=d.b;t3.innerHTML=d.c;
}

/* ===== TEXT SIZE ===== */
let scale=1;
function resizeText(d){
 scale+=d*0.1;
 scale=Math.max(0.6,Math.min(scale,1.6));
 t1.style.fontSize=(28*scale)+'px';
 t2.style.fontSize=(20*scale)+'px';
 t3.style.fontSize=(19*scale)+'px';
 localStorage.setItem('txtScale',scale);
}
const ss=localStorage.getItem('txtScale');
if(ss){scale=parseFloat(ss);resizeText(0);}

/* ===== SHARE ===== */
function shareLink(){
 const data={a:t1.innerHTML,b:t2.innerHTML,c:t3.innerHTML};
 const url=location.href.split('?')[0]+'?d='+encodeURIComponent(JSON.stringify(data));
 if(navigator.share){
  navigator.share({title:'Happy New Year 2026',url});
 }else{
  navigator.clipboard.writeText(url).then(()=>alert('Link copy ho gaya'));
 }
}

/* ===== TEXT TO SPEECH (100% RELIABLE) ===== */
let selectedVoice=null;

function loadVoice(){
 const voices=speechSynthesis.getVoices();
 selectedVoice = voices.find(v=>v.lang==='hi-IN') || voices[0];
}

speechSynthesis.onvoiceschanged = loadVoice;
loadVoice();

function speakText(){
 if(!('speechSynthesis' in window)) return;
 speechSynthesis.cancel();

 if(!selectedVoice){
  setTimeout(speakText,200);
  return;
 }

 const text = t1.innerText+' '+t2.innerText+' '+t3.innerText;
 const u = new SpeechSynthesisUtterance(text);
 u.lang='hi-IN';
 u.rate=0.9;
 u.pitch=0.9;
 u.voice=selectedVoice;
 speechSynthesis.speak(u);
}

/* ===== FIREWORKS (FROM FILE 1) ===== */
let audioCtx;
function boom(){
 if(!audioCtx)audioCtx=new (AudioContext||webkitAudioContext)();
 const t=audioCtx.currentTime;
 const o=audioCtx.createOscillator(),g=audioCtx.createGain();
 o.type='triangle';
 o.frequency.setValueAtTime(70,t);
 o.frequency.exponentialRampToValueAtTime(30,t+1.2);
 g.gain.setValueAtTime(2.8,t);
 g.gain.exponentialRampToValueAtTime(.001,t+1.4);
 o.connect(g).connect(audioCtx.destination);
 o.start(t);o.stop(t+1.4);
}

const c=document.getElementById('fx'),ctx=c.getContext('2d',{alpha:true});
let w,h,particles=[],raf=null,intv=null;

addEventListener('resize',()=>{w=c.width=innerWidth;h=c.height=innerHeight});
dispatchEvent(new Event('resize'));

function startFireworks(){
 if(intv) return;
 intv=setInterval(explode,900);
 draw();
}
function explode(){
 boom();
 const cx=Math.random()*w*0.6+w*0.2;
 const cy=Math.random()*h*0.4+h*0.1;
 for(let i=0;i<260;i++){
  const a=Math.random()*Math.PI*2;
  const s=Math.random()*9+5;
  particles.push({
   x:cx,y:cy,
   vx:Math.cos(a)*s,
   vy:Math.sin(a)*s,
   life:140,
   len:18+Math.random()*22,
   w:3+Math.random()*4,
   hue:Math.random()*360
  });
 }
}
function draw(){
 ctx.save();
 ctx.globalCompositeOperation='destination-out';
 ctx.fillStyle='rgba(0,0,0,0.18)';
 ctx.fillRect(0,0,w,h);
 ctx.restore();
 ctx.globalCompositeOperation='lighter';

 particles.forEach(p=>{
  const px=p.x,py=p.y;
  p.x+=p.vx;p.y+=p.vy;p.vy+=0.04;p.life--;
  ctx.strokeStyle=`hsla(${p.hue},100%,60%,0.95)`;
  ctx.lineWidth=p.w;ctx.lineCap='round';
  ctx.beginPath();
  ctx.moveTo(px,py);
  ctx.lineTo(p.x-p.vx*p.len*0.06,p.y-p.vy*p.len*0.06);
  ctx.stroke();
 });

 ctx.globalCompositeOperation='source-over';
 particles=particles.filter(p=>p.life>0);
 raf=requestAnimationFrame(draw);
}

/* ===== BACKGROUND SAFE ===== */
document.addEventListener('visibilitychange',()=>{
 if(document.hidden){
  speechSynthesis.cancel();
  if(intv){clearInterval(intv);intv=null;}
  if(raf){cancelAnimationFrame(raf);raf=null;}
 }else{
  if(opened){
   startFireworks();
  }
 }
});
</script>
</body>
</html>
